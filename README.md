# FL-MMDAgg

We evaluate the performance our MMDAgg test ([paper](https://arxiv.org/abs/2110.15073), [code](https://github.com/antoninschrab/mmdagg-paper)) on the Failing Loudly benchmark ([paper](https://proceedings.neurips.cc/paper/2019/hash/846c260d715e5b854ffad5f70a516c88-Abstract.html), [code](https://github.com/steverab/failing-loudly/)) which has also been considered by KÃ¼bler et al. ([paper](https://arxiv.org/abs/2206.08843), [code](https://github.com/jmkuebler/autoML-TST-paper)). The code in this repository is based on the two aforementionned repositories which are both under the MIT License.

The code for MMDAgg in [mmdaggupdate](mmdaggupdate) has been slighly modified to be memory-efficient.

## Results (table)

| Sample size | 10 | 20 | 50 | 100 | 200 | 500 | 1000 | 10000 |
| -- | -- | -- | -- | -- | -- | -- | -- | -- |
| MMDAgg Gaussian | 0.17 | 0.26 | 0.34 | 0.40 | 0.41 | 0.50 | 0.61 | 0.76 |
| MMDAgg Laplace | 0.22 | 0.27 | 0.37 | 0.44 | 0.46 | 0.55 | 0.66 | 0.80 |

## Datasets

The adversarial datasets can either be generated by running 
```
python generate_adv_samples.py
```
which saves them in a `datasets` directory,
or they can be directly downloaded from the [failing-loudly](https://github.com/steverab/failing-loudly/tree/42afd118237ded54c6ebef4a3417d8c1db44f76d/datasets) repository. 

## Experiments

The environment is the same as the one considered in the [autoML-TST-paper](https://github.com/jmkuebler/autoML-TST-paper) repository, it can be installed by following their instructions.

The experiments for MMDAgg Laplace can be run using 
```
bash script.sh
```
The results are saved in [paper_results/mmdagg_laplace](paper_results/mmdagg_laplace).
The experiments consist of
'embarrassingly parallel for loops' which can be computed efficiently using parallel computing libraries such as `joblib` or `dask`.

The experiments for MMDAgg Gaussian can be run by first replacing 'laplace' by 'gaussian' on line 39 of [pipeline.py](pipeline.py) and on line 138 of [shift_tester.py](shift_tester.py), and then executing
```
bash script.sh
```
The results are then saved in [paper_results/mmdagg_gaussian](paper_results/mmdagg_gaussian).

## Results (numerical)

The test power for MMDAgg for those experiments can then be obtained by running
```
python results.py
```
The results are presented in the table above.

## License

MIT License (see [LICENSE.md](LICENSE.md))
